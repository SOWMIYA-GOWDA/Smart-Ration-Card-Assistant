<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Smart Ration Chatbot</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(to right, #232526, #414345);
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      color: white;
    }
    .chat-container {
      width: 400px;
      height: 600px;
      background: #1e1e1e;
      border-radius: 15px;
      display: none; /* hidden until Start pressed */
      flex-direction: column;
      box-shadow: 0 8px 20px rgba(0,0,0,0.4);
      overflow: hidden;
    }
    .chat-box {
      flex: 1;
      padding: 15px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
    }
    .message {
      max-width: 80%;
      padding: 10px 15px;
      border-radius: 15px;
      margin: 5px 0;
      position: relative;
      word-wrap: break-word;
    }
    .user {
      background: #4caf50;
      align-self: flex-end;
      border-bottom-right-radius: 5px;
    }
    .bot {
      background: #333;
      align-self: flex-start;
      border-bottom-left-radius: 5px;
    }
    .timestamp {
      font-size: 10px;
      color: #bbb;
      margin-top: 3px;
      text-align: right;
    }
    .input-area {
      display: flex;
      padding: 10px;
      background: #2b2b2b;
    }
    .input-area input {
      flex: 1;
      padding: 10px;
      border: none;
      border-radius: 20px;
      outline: none;
      margin-right: 10px;
    }
    .input-area button {
      background: #4caf50;
      border: none;
      padding: 10px 15px;
      border-radius: 50%;
      cursor: pointer;
      color: white;
      font-weight: bold;
    }
    .speak-btn {
      margin-left: 8px;
      background: #555;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      color: white;
      padding: 3px 7px;
      font-size: 12px;
    }
    .reset-btn {
      background: crimson;
      border: none;
      padding: 6px 12px;
      border-radius: 8px;
      margin: 5px;
      cursor: pointer;
      color: white;
      font-weight: bold;
      align-self: center;
    }
    .typing {
      font-style: italic;
      color: #aaa;
      margin: 5px 0;
    }
    /* Front page */
    .start-page {
      text-align: center;
    }
    .start-btn {
      background: #4caf50;
      padding: 12px 25px;
      border: none;
      border-radius: 25px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      color: white;
      transition: 0.3s;
    }
    .start-btn:hover {
      background: #388e3c;
    }
  </style>
</head>
<body>
  <!-- Front Page -->
  <div class="start-page" id="startPage">
    <h1>👋 Welcome to Smart Ration Chatbot</h1>
    <p>Check your ration card details, stock, govt updates, shop timings, and more.</p>
    <button class="start-btn" onclick="startChat()">Start Chat</button>
  </div>

  <!-- Chatbot -->
  <div class="chat-container" id="chatContainer">
    <div class="chat-box" id="chatBox"></div>
    <button class="reset-btn" onclick="resetChat()">Reset Chat 🔄</button>
    <div class="input-area">
      <input type="text" id="userInput" placeholder="Type your message...">
      <button onclick="sendMessage()">➤</button>
    </div>
  </div>

  <script>
    // 15 Sample ration card dataset
    const rationData = {
      "RC001": {
        name: "Ramesh Kumar",
        family: ["Ramesh", "Lakshmi", "Rahul", "Priya"],
        ages: [45, 42, 18, 15],
        address: "Chennai, TN",
        type: "White Card",
        stock: { rice: "20kg", wheat: "10kg", sugar: "5kg", dal: "4kg" },
        govt: "All members updated biometrics.",
        restock: "2025-09-01"
      },
      "RC002": {
        name: "Sowmiya Raj",
        family: ["Sowmiya", "Arun", "Meena"],
        ages: [40, 20, 15],
        address: "Madurai, TN",
        type: "Green Card",
        stock: { rice: "15kg", wheat: "5kg", sugar: "3kg", dal: "2kg" },
        govt: "Arun needs to update Aadhaar details.",
        restock: "2025-09-02"
      },
      "RC003": {
        name: "Vignesh B",
        family: ["Vignesh", "Anitha"],
        ages: [50, 48],
        address: "Coimbatore, TN",
        type: "Yellow Card",
        stock: { rice: "10kg", wheat: "5kg", sugar: "2kg", dal: "1kg" },
        govt: "Anitha pending biometric update.",
        restock: "2025-09-03"
      },
      "RC004": {
        name: "Priya M",
        family: ["Priya", "Senthil", "Dinesh", "Keerthi"],
        ages: [35, 38, 12, 8],
        address: "Salem, TN",
        type: "White Card",
        stock: { rice: "18kg", wheat: "9kg", sugar: "4kg", dal: "3kg" },
        govt: "All members updated biometrics.",
        restock: "2025-09-04"
      },
      "RC005": {
        name: "Arjun S",
        family: ["Arjun", "Deepa"],
        ages: [30, 28],
        address: "Trichy, TN",
        type: "Green Card",
        stock: { rice: "12kg", wheat: "6kg", sugar: "2kg", dal: "2kg" },
        govt: "Deepa needs Aadhaar update.",
        restock: "2025-09-05"
      },
      "RC006": {
        name: "Karthik R",
        family: ["Karthik", "Suma", "Jaya"],
        ages: [55, 50, 25],
        address: "Thanjavur, TN",
        type: "Yellow Card",
        stock: { rice: "20kg", wheat: "10kg", sugar: "5kg", dal: "5kg" },
        govt: "All good.",
        restock: "2025-09-06"
      },
      "RC007": {
        name: "Meena Devi",
        family: ["Meena", "Ravi"],
        ages: [60, 65],
        address: "Erode, TN",
        type: "White Card",
        stock: { rice: "15kg", wheat: "7kg", sugar: "3kg", dal: "2kg" },
        govt: "Ravi Aadhaar pending.",
        restock: "2025-09-07"
      },
      "RC008": {
        name: "Suresh K",
        family: ["Suresh", "Latha", "Anil"],
        ages: [48, 45, 20],
        address: "Vellore, TN",
        type: "Green Card",
        stock: { rice: "16kg", wheat: "8kg", sugar: "4kg", dal: "2kg" },
        govt: "All members updated biometrics.",
        restock: "2025-09-08"
      },
      "RC009": {
        name: "Divya R",
        family: ["Divya", "Gokul"],
        ages: [28, 32],
        address: "Tirunelveli, TN",
        type: "Yellow Card",
        stock: { rice: "8kg", wheat: "4kg", sugar: "2kg", dal: "1kg" },
        govt: "Biometric update required.",
        restock: "2025-09-09"
      },
      "RC010": {
        name: "Ravi S",
        family: ["Ravi", "Mala", "Santhosh"],
        ages: [45, 40, 18],
        address: "Kanchipuram, TN",
        type: "White Card",
        stock: { rice: "19kg", wheat: "9kg", sugar: "5kg", dal: "4kg" },
        govt: "All good.",
        restock: "2025-09-10"
      },
      "RC011": {
        name: "Swathi P",
        family: ["Swathi", "Prakash", "Rohit"],
        ages: [36, 40, 10],
        address: "Nagapattinam, TN",
        type: "Green Card",
        stock: { rice: "14kg", wheat: "6kg", sugar: "3kg", dal: "2kg" },
        govt: "Prakash Aadhaar update pending.",
        restock: "2025-09-11"
      },
      "RC012": {
        name: "Mohan L",
        family: ["Mohan", "Radha"],
        ages: [50, 47],
        address: "Pondicherry",
        type: "Yellow Card",
        stock: { rice: "12kg", wheat: "6kg", sugar: "2kg", dal: "2kg" },
        govt: "All good.",
        restock: "2025-09-12"
      },
      "RC013": {
        name: "Kavitha S",
        family: ["Kavitha", "Selva", "Harini"],
        ages: [42, 44, 16],
        address: "Thoothukudi, TN",
        type: "White Card",
        stock: { rice: "17kg", wheat: "8kg", sugar: "3kg", dal: "3kg" },
        govt: "Harini Aadhaar pending.",
        restock: "2025-09-13"
      },
      "RC014": {
        name: "Manoj K",
        family: ["Manoj", "Lalitha"],
        ages: [34, 30],
        address: "Namakkal, TN",
        type: "Green Card",
        stock: { rice: "10kg", wheat: "5kg", sugar: "2kg", dal: "2kg" },
        govt: "All good.",
        restock: "2025-09-14"
      },
      "RC015": {
        name: "Geetha M",
        family: ["Geetha", "Sankar", "Vivek", "Sneha"],
        ages: [38, 42, 12, 8],
        address: "Dharmapuri, TN",
        type: "Yellow Card",
        stock: { rice: "18kg", wheat: "9kg", sugar: "4kg", dal: "3kg" },
        govt: "Sneha biometric update pending.",
        restock: "2025-09-15"
      }
    };

    const chatBox = document.getElementById("chatBox");

    function getTime() {
      const now = new Date();
      return now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    }

    function addMessage(text, sender="bot", withSpeak=false) {
      const msgDiv = document.createElement("div");
      msgDiv.classList.add("message", sender);
      msgDiv.innerHTML = text;
      
      if (sender === "bot" && withSpeak) {
        const speakBtn = document.createElement("button");
        speakBtn.classList.add("speak-btn");
        speakBtn.textContent = "🔊";
        speakBtn.onclick = () => speak(text);
        msgDiv.appendChild(speakBtn);
      }

      const time = document.createElement("div");
      time.classList.add("timestamp");
      time.textContent = getTime();
      msgDiv.appendChild(time);

      chatBox.appendChild(msgDiv);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    function showTyping() {
      const typingDiv = document.createElement("div");
      typingDiv.classList.add("typing");
      typingDiv.id = "typing";
      typingDiv.textContent = "Bot is typing...";
      chatBox.appendChild(typingDiv);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    function removeTyping() {
      const typingDiv = document.getElementById("typing");
      if (typingDiv) typingDiv.remove();
    }

    function sendMessage() {
      const input = document.getElementById("userInput");
      const text = input.value.trim();
      if (!text) return;

      addMessage(text, "user");
      input.value = "";

      showTyping();
      setTimeout(() => {
        removeTyping();
        botResponse(text);
      }, 1200); // typing delay
    }

    function botResponse(text) {
      const parts = text.split(" ");
      const card = parts[0]?.toUpperCase();
      const query = parts[1]?.toLowerCase();

      if (!rationData[card]) {
        addMessage("❌ Card not found!", "bot", true);
        return;
      }

      let reply = "";
      const data = rationData[card];

      if (!query || query === "details") {
        reply = `<b>Card Holder:</b> ${data.name}<br>
                 <b>Family:</b> ${data.family.join(", ")}<br>
                 <b>Ages:</b> ${data.ages.join(", ")}<br>
                 <b>Address:</b> ${data.address}<br>
                 <b>Type:</b> ${data.type}<br>
                 <b>Card No:</b> ${card}`;
      } else if (query === "stock") {
        reply = `<b>Stock Available:</b><br>
                 Rice: ${data.stock.rice}<br>
                 Wheat: ${data.stock.wheat}<br>
                 Sugar: ${data.stock.sugar}<br>
                 Dal: ${data.stock.dal}`;
      } else if (query === "govt" || query === "update") {
        reply = `<b>Govt Update:</b> ${data.govt}`;
      } else if (query === "timing") {
        const hour = new Date().getHours();
        reply = hour >= 9 && hour < 18 
          ? "✅ Shop is OPEN (9AM - 6PM)" 
          : "❌ Shop is CLOSED (Opens 9AM - 6PM)";
      } else if (query === "restock") {
        reply = `<b>Next Restock:</b> ${data.restock}`;
      } else {
        reply = "❓ Please ask 'details', 'stock', 'govt update', 'timing', or 'restock'.";
      }

      addMessage(reply, "bot", true);
    }

    function speak(text) {
      if (window.speechSynthesis.speaking) {
        window.speechSynthesis.cancel();
      }
      const utter = new SpeechSynthesisUtterance(text.replace(/<[^>]*>?/gm, ''));
      utter.lang = "en-IN";
      utter.rate = 1;
      window.speechSynthesis.speak(utter);
    }

    function resetChat() {
      chatBox.innerHTML = "";
      addMessage("👋 Hi! Enter your card number (e.g., RC001 details, RC002 stock)", "bot", true);
    }

    function startChat() {
      document.getElementById("startPage").style.display = "none";
      document.getElementById("chatContainer").style.display = "flex";
      resetChat();
    }
  </script>
</body>
</html>
